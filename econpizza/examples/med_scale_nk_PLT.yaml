# Description: 
# A medium scale NK model with capital, capital adjustment costs, capital utilization costs, habits, price indexation, nominal wage rigidity, and price-level targeting
# The model is inspired by "A Baseline DSGE Model" (Fernández-Villaverde and Rubio-Ramírez, manuscript), and "The Emprirical Implications of the Interest-Rate Lower Bound" (Gust et al., Fed WP 2012-083)
# Authors: Gregor Boehl [mail@gregorboehl.com], Sven Eis [eissven95@gmail.com]
---

name: 'med_scale_nk_plt'
variables: [ p, y_prod, g, bprof, dd, ds, t, qb, b, pi, pitilde, lam, y, mc, w, n, Rk, cap_util, k , c, R, i, rp, piw, piwtilde, q, cap_util_costs, Rn]
parameters: [ kappa, beta , epsilonp, phip, alpha, a, h, epsilonw, phiw, chi, eta, aw, delta, phii, sigmaa , rho_r, rho_rp, phi_p, phi_y]
shocks: [ e_rp ]

equations:
    # Firms
    ~ (pi/pitildeLag - 1)*pi/pitildeLag = beta*lamPrime/lam*(piPrime/pitilde - 1)*piPrime/pitilde*yPrime/y + epsilonp/phip*(mc-(epsilonp-1)/epsilonp) # price Phillips curve
    ~ log(piPrime) = log(pPrime)-log(p) # price
    ~ mc = (w*n)/((p*y)*(1-alpha)) # real marginal costs
    ~ p*Rk=alpha/(1-alpha)*(w*n)/(cap_util*k) # 
    ~ pitilde= piSS**a*pi**(1-a) # price indexation
    ~ y_prod = (k*cap_util)**alpha*n**(1-alpha) # production function
       
    # Households
    ~ lam = 1/(c-h*cLag) - beta*h/(cPrime-h*c) # stochastic discount factor
    ~ lam = beta*R*rp*(1/piPrime)*lamPrime # Euler equation
    ~ phiw*(piw/piwtilde - 1)*piw/piwtilde = beta*phiw*((piwPrime/piwtildePrime - 1)*piwPrime/piwtildePrime)+n*lam*epsilonw*(chi*((n**eta)/lam)-(epsilonw-1)/epsilonw*w/p) # wage Phillips curve
    ~ piw = w/wLag # wage inflation
    ~ piwtilde = piSS**aw*piLag**(1-aw) # wage inflation indexation
    ~ q=beta*lamPrime/lam*RkPrime*cap_utilPrime-cap_util_costsPrime+(1-delta)*qPrime # HH optimal choice of physical capital
    ~ 1 = q*(1 - phii/2*(i/iLag - 1)**2 - phii*(i/iLag - 1)*i/iLag) + beta*lamPrime/lam*qPrime*phii*(iPrime/i - 1)*(iPrime/i)**2 # investment Euler equation
    ~ Rk = RkSS*exp(sigmaa*(cap_util-1)) # HH optimal choice of utilization
    ~ cap_util_costs = RkSS/sigmaa*(exp(sigmaa*(cap_util-1))-1) # capital utilisation costs
    ~ k = (1-delta)*kLag + (1 - phii/2*(i/iLag - 1)**2)*i # law of motion for capital
    ~ dd + c + t + phii/2*(i/iLag - 1)**2*i = (w/p)*n - phiw/2*(piw/piwSS - 1)**2 + rpLag*RLag/p*ddLag + (1 - mc - phip/2*(pi/pitildeLag - 1)**2)*y + (q*(1 - phii/2*(i/iLag - 1)**2) - 1)*i + bprof # deposits demand via HH budget constraint

    # Financial Intermediary
    ~ ds = qb*b + q*k # deposits supply
    ~ rp*R = (1 + kappa*qbPrime)/qb # no arbitrage condition for the bond price
    ~ bprof = ((1+kappa*qb)*bLag + RkLag*qLag*kLag - rpLag*RLag*ddLag)/p # financial intermediary` profits
   
    # Government
    ~ g + (1+kappa*qb)/p*bLag = qb*b + t # government budget constraint
    ~ g = 0.2*y # level of government spending
    ~ b = y/qb # level of government bonds

    # Central Bank
    ~ Rn = (RSS*((p/pSS)**phi_p)*((y/ySS)**phi_y))**(1-rho_r)*RnLag**rho_r # Taylor rule for the notional nominal interest rate
    ~ R = max(1, Rn) # (actual) nominal interest rate, subject to ZLB

    # Clearing
    ~ c + i + g + phii/2*(i/iLag - 1)**2*i + cap_util_costs*k = (1-phip*(pi/pitildeLag - 1)**2/2)*y_prod # goods market clearing
    ~ c + i + g = y # definition of "effective" output

    # Exogenous Process
    ~ rp=rpSS*(rpLag/rpSS)**rho_rp*exp(e_rp) # risk premium shock

steady_state:
    fixed_values:
        # parameters:
        epsilonp: 5. # elasticity of substitution
        alpha: 0.33 # capital income share
        beta: 0.995 # discount factor
        epsilonw: 3. # elasticity of substitution for wages
        phip: 113.36 # parameter on the costs of price adjustment
        delta: 0.025 # depreciation rate
        phii: 3.48 # parameter on the costs of investment adjustment
        phi_p: 0.2 # Taylor rule coefficient on price
        phi_y: 0.1 # Taylor rule coefficient on output
        h: 0.52 # habit formation parameter
        rho_r: .8 # persistence in (notional) nominal interest rate
        eta: 0.33 # inverse of Frisch elasticity of labour supply
        rho_rp: .8 # persistence of risk premium shock
        a: .44 # coefficient on inflation target in price indexation
        aw: .55 # coefficient on inflation target in wage inflation indexation
        phiw: 4029.73 # parameter on the costs of wage adjustment
        sigmaa: 5.64 # elasticity of the rental cost of capital with respect to the utilization
        kappa: 0.975 # decay parameter for coupon payments of perpetual bonds

        # steady states: 
        pi: 1 # steady state inflation
        cap_util: 1. # steady state capital utilisation share
        rp: 1. # steady state risk premium shock 
        R: pi/beta # steady state nominal interest rate
        Rn: R # steady state notional nominal interest rate
        n: 0.33 # steady state labour hours
        q: 1. # steady state value of capital in consumption units
        pitilde: pi # steady state value of price indexation
        piw: 1. # steady state value of wage inflation
        piwtilde: pi # steady state value of wage inflation indexation
        mc: (epsilonp-1)/epsilonp # steady state marginal costs

    init_guesses:
        chi: 1e+1 # parameter on the disutility of labour
